set(LR_SOURCES ../src/lr/lr.cpp ../src/lr/coefficients.cpp ../src/generic/utility.cpp ../src/generic/matrix.cpp ../src/generic/timer.cpp ../src/generic/fft.cpp ../src/generic/netcdf.cpp)
set(LR_SOURCES_GPU ../src/lr/lr.cu ../src/lr/coefficients.cu ../src/generic/utility.cu ../src/generic/matrix.cu ../src/generic/timer.cu ../src/generic/fft.cu ../src/generic/kernels.cu ../src/generic/netcdf.cpp)

if(${CUDA_ENABLED})
  cuda_add_executable(linear_landau linear_landau.cu ${LR_SOURCES_GPU})
  cuda_add_cublas_to_target(linear_landau)
  cuda_add_cufft_to_target(linear_landau)
  target_link_libraries(linear_landau ${CUDA_curand_LIBRARY})

  cuda_add_executable(linear_landau_2d linear_landau_2d.cu ${LR_SOURCES_GPU})
  cuda_add_cublas_to_target(linear_landau_2d)
  cuda_add_cufft_to_target(linear_landau_2d)
  target_link_libraries(linear_landau_2d ${CUDA_curand_LIBRARY})

  cuda_add_executable(linear_landau_3d linear_landau_3d.cu ${LR_SOURCES_GPU})
  cuda_add_cublas_to_target(linear_landau_3d)
  cuda_add_cufft_to_target(linear_landau_3d)
  target_link_libraries(linear_landau_3d ${CUDA_curand_LIBRARY})
else()
  add_executable(linear_landau linear_landau.cpp ${LR_SOURCES})

  add_executable(linear_landau_2d linear_landau_2d.cpp ${LR_SOURCES})

  add_executable(linear_landau_3d linear_landau_3d.cpp ${LR_SOURCES})
endif()

target_link_libraries(linear_landau    ${FFTW_LIBRARIES} ${NETCDF_LIBRARIES})
target_link_libraries(linear_landau_2d ${FFTW_LIBRARIES} ${NETCDF_LIBRARIES})
target_link_libraries(linear_landau_3d ${FFTW_LIBRARIES} ${NETCDF_LIBRARIES})

if(${MKL_ENABLED})
  target_link_libraries(linear_landau    ${MKL_LIBRARIES})
  target_link_libraries(linear_landau_2d ${MKL_LIBRARIES})
  target_link_libraries(linear_landau_3d ${MKL_LIBRARIES})
else()
  target_link_libraries(linear_landau    ${OPENBLAS_LIBRARIES} Threads::Threads "-lgfortran")
  target_link_libraries(linear_landau_2d ${OPENBLAS_LIBRARIES} Threads::Threads "-lgfortran")
  target_link_libraries(linear_landau_3d ${OPENBLAS_LIBRARIES} Threads::Threads "-lgfortran")
endif()

if(${CUDA_ENABLED})
  cuda_add_executable(vlasov_poisson vlasov_poisson.cu ${LR_SOURCES_GPU})
  cuda_add_cublas_to_target(vlasov_poisson)
  cuda_add_cufft_to_target(vlasov_poisson)
  target_link_libraries(vlasov_poisson ${CUDA_curand_LIBRARY})
else()
  add_executable(vlasov_poisson vlasov_poisson.cpp ${LR_SOURCES})
endif()
target_link_libraries(vlasov_poisson ${FFTW_LIBRARIES} ${NETCDF_LIBRARIES})
if(${MKL_ENABLED})
  target_link_libraries(vlasov_poisson ${MKL_LIBRARIES})
else()
  target_link_libraries(vlasov_poisson ${OPENBLAS_LIBRARIES} Threads::Threads "-lgfortran")
endif()

add_executable(alfven_waves alfven_waves.cpp ${LR_SOURCES})
target_link_libraries(alfven_waves ${FFTW_LIBRARIES} ${NETCDF_LIBRARIES})
if(${MKL_ENABLED})
  target_link_libraries(alfven_waves ${MKL_LIBRARIES})
else()
  target_link_libraries(alfven_waves ${OPENBLAS_LIBRARIES} Threads::Threads "-lgfortran")
endif()

add_executable(alfven_waves_test alfven_waves_test.cpp ${LR_SOURCES})
target_link_libraries(alfven_waves_test ${FFTW_LIBRARIES} ${NETCDF_LIBRARIES})
if(${MKL_ENABLED})
  target_link_libraries(alfven_waves_test ${MKL_LIBRARIES})
else()
  target_link_libraries(alfven_waves_test ${OPENBLAS_LIBRARIES} Threads::Threads "-lgfortran")
endif()
add_test(NAME alfven_waves COMMAND alfven_waves_test)

